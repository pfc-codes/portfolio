---
// Frontmatter - processed at build time
---

<div id="pc-wrap">
  <canvas id="pc-canvas"></canvas>

  <nav id="ui-overlay" aria-label="Primary">
    <div class="ui-panel">
      <a href="/projects" class="ui-link">Projects</a>
      <a href="/about" class="ui-link">About</a>
      <a href="/contact" class="ui-link">Contact</a>
    </div>
  </nav>
</div>

<script>
  import { mountPointCloudHero } from "@/scripts/pointcloud-hero.js";

  let cleanup: (() => void) | undefined;

  const mount = async () => {
    // Reset overlay state on entry (useful with view transitions)
    document.body.classList.remove("ui-ready");

    cleanup = await mountPointCloudHero({
      canvasId: "pc-canvas",
      wrapId: "pc-wrap",
      autoStartDelayMs: 500,
    });
  };

  if (document.readyState === "loading") {
    window.addEventListener("DOMContentLoaded", mount, { once: true });
  } else {
    mount();
  }

  window.addEventListener(
    "astro:before-swap",
    () => {
      document.body.classList.remove("ui-ready");
      cleanup?.();
    },
    { once: true }
  );

  window.addEventListener("ui-ready", () => {
    document.body.classList.add("ui-ready");
  });
</script>
